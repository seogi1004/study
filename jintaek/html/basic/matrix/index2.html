<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script src="../../../lib/jquery-1.11.0.min.js"></script>
    <script src="../../../lib/jui.chart.min.js"></script>
    <script src="coordinate.js"></script>
    <script>
        jui.define("chart.brush.template", [ "util.base", "util.math" ], function() {
            var Template = function() {
                this.draw = function() {

                    var g = this.chart.svg.group();
                    var data = this.listData();
                    var value = null;

                    for(var key in data){
                        if(key==0){
                            value = 'M' + this.axis.x(data[key][0]) + ' ' + this.axis.y(data[key][1]) + ' '
                        }else{
                            value += 'L' + this.axis.x(data[key][0]) + ' ' + this.axis.y(data[key][1]) + ' '
                        }
                    };

                    g.append(this.chart.svg.path({
                        fill: '#ff7a00',
                        "fill-opacity": 0.5,
                        stroke :"#ff7a00",
                        "stroke-width" : 1,
                        d : value + ' Z'
                    }));

                    return g;
                }
            }

            Template.setup = function() {
                return {
                    size: 5
                }
            }

            return Template;
        }, "chart.brush.core");

        jui.ready([ "chartx.coordinate" ], function(builder) {

            var data = [
                [ -2, -2, 1 ],
                [ -2, 2, 1 ], // 원점 기준, 대칭 이동
                [ 2, 2, 1 ], // Y축 기준, 대칭 이동
                [ 2, -2, 1 ], // X축 기준, 대칭 이동
            ];

            window.c = builder("#chart", {
                domain: [ -15, 15 ],
                brush: "template",
                data: data
            });

            var val = [];

            window.matrix = function(type){

                var matrixs = {
                    scale  : [[val[0],0,0],[0,val[0],0],[0,0,1]],
                    scaleX : [[val[0],0,0],[0,1,0],[0,0,1]],
                    scaleY : [[1,0,0],[0,val[0],0],[0,0,1]],
                    translateX : [[1,0,val[0]],[0,1,0],[0,0,1]],
                    translateY : [[1,0,0],[0,1,val[0]],[0,0,1]],
                    skewX : [[1,Math.tan(val[0]),0],[0,1,0],[0,0,1]],
                    skewY : [[1,0,0],[Math.tan(val[0]),1,0],[0,0,1]],
                    rotate : [[Math.cos((val[0]/180)*Math.PI),-Math.sin((val[0]/180)*Math.PI),0],[Math.sin((val[0]/180)*Math.PI),Math.cos((val[0]/180)*Math.PI),0],[0,0,1]]
                }

                window.calc(matrixs[type]);

            };

            window.reset = function(){
                data = [
                    [ -2, -2, 1 ],
                    [ -2, 2, 1 ], // 원점 기준, 대칭 이동
                    [ 2, 2, 1 ], // Y축 기준, 대칭 이동
                    [ 2, -2, 1 ], // X축 기준, 대칭 이동
                ];
                window.c.update(data);
            };

            window.calc = function(matrixs){

                for(var i = 0; i < data.length; i++) {
                    data[i] = multiple(matrixs, data[i]);
                };

                function multiple(a, b) {
                    var m = [];
                    for(var i = 0; i < a.length; i++) {
                        var sum = 0;
                        for(var j = 0; j < a[i].length; j++) {
//                            if(b[j] != undefined && b[j] != null){
//                                sum += a[i][j] * b[j];
//                            }
                            sum += a[i][j] * b[j];
                        }
                        m.push(sum);
                    }
                    return m;
                }
                window.c.update(data);

            };


            window.scale = function(type){
                switch (type){
                    case 'up'   : val[0] = 1.1; break;
                    case 'down' : val[0] = 0.9; break;
                }
                window.matrix('scale');
            };

            window.scaleX = function(type){
                switch (type){
                    case 'up'   : val[0] = 1.1; break;
                    case 'down' : val[0] = 0.9; break;
                }
                window.matrix('scaleX');
            }

            window.scaleY = function(type){
                switch (type){
                    case 'up'   : val[0] = 1.1; break;
                    case 'down' : val[0] = 0.9; break;
                }
                window.matrix('scaleY');
            }

            window.move = function(type){
                switch (type){
                    case 'right'   : val[0] = 1; window.matrix('translateX'); break;
                    case 'left'    : val[0] = -1; window.matrix('translateX'); break;
                    case 'up'      : val[0] = 1; window.matrix('translateY'); break;
                    case 'down'    : val[0] = -1; window.matrix('translateY'); break;
                }
            }

            window.skewX = function(type){
                val[0] = type;
                window.matrix('skewX');
            };

            window.skewY = function(type){
                val[0] = type;
                window.matrix('skewY');
            };

            window.rotate = function(type){
                val[0] = type;
                window.matrix('rotate');
            }

        });
    </script>
</head>

<body>

<div>
    <button type="button" onclick="window.reset()">RESET</button>
    <hr/>
    <button type="button" onclick="window.scale('up')">scale+</button>
    <button type="button" onclick="window.scale('down')">scale-</button>
    <button type="button" onclick="window.scaleX('up')">scaleX+</button>
    <button type="button" onclick="window.scaleX('down')">scaleX-</button>
    <button type="button" onclick="window.scaleY('up')">scaleY+</button>
    <button type="button" onclick="window.scaleY('down')">scaleY-</button>
    <hr/>
    <button type="button" onclick="window.skewX(10)">skewX</button>
    <button type="button" onclick="window.skewY(10)">skewY</button>
    <hr/>
    <button type="button" onclick="window.move('right')">x move+</button>
    <button type="button" onclick="window.move('left')">x move-</button>
    <button type="button" onclick="window.move('up')">y move+</button>
    <button type="button" onclick="window.move('down')">y move-</button>
    <hr/>
    <button type="button" onclick="window.rotate(30)">rotate 30</button>
    <button type="button" onclick="window.rotate(-30)">rotate -30</button>
    <hr/>
</div>


<div id="chart"></div>

</body>
</html>